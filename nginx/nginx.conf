user  nginx;
worker_processes auto;

events { worker_connections 1024; }

http {
  include       /etc/nginx/mime.types;
  default_type  application/octet-stream;

  sendfile on;
  keepalive_timeout 65;

  # Upstreams
  upstream transfer_upstream { server transfer_service:8000; }
  upstream search_upstream   { server search_service:8001; }

  server {
    listen 80;

    # /transfer -> transfer_service:8000
    location /transfer {
      proxy_pass http://transfer_upstream;
      proxy_set_header Host $host;
    }

    # /search -> search_service:8001
    location /search {
      proxy_pass http://search_upstream;
      proxy_set_header Host $host;
    }
  }

  # In case the default conf still exists, it's harmless but:
  # include /etc/nginx/conf.d/*.conf;
}